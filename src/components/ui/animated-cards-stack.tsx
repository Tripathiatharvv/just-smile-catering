"use client"import * as React from "react"import { VariantProps, cva } from "class-variance-authority"import {  HTMLMotionProps,  MotionValue,  motion,  useMotionTemplate,  useScroll,  useTransform,} from "framer-motion"import { cn } from "@/lib/utils"const cardVariants = cva("absolute will-change-transform", {  variants: {    variant: {      dark: "flex size-full flex-col items-center justify-center gap-6 rounded-2xl border border-stone-700/50 bg-accent-foreground/80 p-6 backdrop-blur-md",      light:        "flex size-full flex-col items-center justify-center gap-6 rounded-2xl border bg-background/80 p-6 backdrop-blur-md shadow-sm",    },  },  defaultVariants: {    variant: "light",  },})interface ReviewProps extends React.HTMLAttributes<HTMLDivElement> {  rating: number  maxRating?: number}interface CardStickyProps  extends HTMLMotionProps<"div">,  VariantProps<typeof cardVariants> {  arrayLength: number  index: number  incrementY?: number  incrementZ?: number  incrementRotation?: number}interface ContainerScrollContextValue {  scrollYProgress: MotionValue<number>}const ContainerScrollContext = React.createContext<  ContainerScrollContextValue | undefined>(undefined)function useContainerScrollContext() {  const context = React.useContext(ContainerScrollContext)  if (!context) {    throw new Error("useContainerScrollContext must be used within a ContainerScroll")  }  return context}export const ContainerScroll: React.FC<  React.HTMLAttributes<HTMLDivElement>> = ({ children, style, className, ...props }) => {  const scrollRef = React.useRef<HTMLDivElement>(null)  const { scrollYProgress } = useScroll({    target: scrollRef,    offset: ["start start", "end end"],  })  return (    <ContainerScrollContext.Provider value={{ scrollYProgress }}>      <div        ref={scrollRef}        className={cn("relative w-full h-[150vh] sm:h-[200vh]", className)}        style={{ perspective: "1000px", ...style }}        {...props}      >        <div className="sticky top-0 h-screen w-full flex items-center justify-center overflow-hidden">          {children}        </div>      </div>    </ContainerScrollContext.Provider>  )}ContainerScroll.displayName = "ContainerScroll"export const CardsContainer: React.FC<React.HTMLAttributes<HTMLDivElement>> = ({  children,  className,  ...props}) => {  return (    <div      className={cn("relative w-full max-w-[280px] sm:max-w-[380px] h-[400px] sm:h-[500px]", className)}      style={{ perspective: "1000px", transformStyle: "preserve-3d" }}      {...props}    >      {children}    </div>  )}CardsContainer.displayName = "CardsContainer"export const CardTransformed = React.forwardRef<  HTMLDivElement,  CardStickyProps>(  (    {      arrayLength,      index,      incrementY = 12,      incrementZ = 15,      incrementRotation = 0,      className,      variant,      style,      ...props    },    ref  ) => {    const context = useContainerScrollContext()    const progress = context.scrollYProgress    const start = index / arrayLength    const end = (index + 1) / arrayLength    const holdEnd = start + (end - start) * 0.85    const y = useTransform(progress, [start, holdEnd, end], ["0%", "0%", "-150%"])    const opacity = useTransform(progress, [start, holdEnd, end - 0.05], [1, 1, 0])    const scale = useTransform(progress, [start, holdEnd, end], [1, 1, 0.9])    const rotate = useTransform(progress, [start, holdEnd, end], [incrementRotation, incrementRotation, -5])    const zIndex = arrayLength - index    const initialZ = (arrayLength - index) * incrementZ    const initialY = (index - (arrayLength - 1) / 2) * incrementY    const transform = useMotionTemplate`translateZ(${initialZ}px) translateY(${y}) rotate(${rotate}deg) scale(${scale})`    return (      <motion.div        ref={ref}        style={{          ...style,          transform,          zIndex,          opacity,          top: "50%",          marginTop: initialY - 200,         }}        className={cn(cardVariants({ variant, className }), "top-1/2 -translate-y-1/2")}        {...props}      />    )  })CardTransformed.displayName = "CardTransformed"export const ReviewStars = React.forwardRef<HTMLDivElement, ReviewProps>(  ({ rating, maxRating = 5, className, ...props }, ref) => {    const filledStars = Math.floor(rating)    const fractionalPart = rating - filledStars    const emptyStars = maxRating - filledStars - (fractionalPart > 0 ? 1 : 0)    return (      <div        className={cn("flex items-center gap-1", className)}        ref={ref}        {...props}      >        <div className="flex items-center text-[#FFD447]">          {[...Array(filledStars)].map((_, index) => (            <svg              key={`filled-${index}`}              className="size-4 fill-current"              viewBox="0 0 20 20"            >              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.957a1 1 0 00.95.69h4.162c.969 0 1.371 1.24.588 1.81l-3.37 2.448a1 1 0 00-.364 1.118l1.287 3.957c.3.921-.755 1.688-1.54 1.118l-3.37-2.448a1 1 0 00-1.175 0l-3.37 2.448c-.784.57-1.838-.197-1.54-1.118l1.287-3.957a1 1 0 00-.364-1.118L2.05 9.384c-.783-.57-.38-1.81.588-1.81h4.162a1 1 0 00.95-.69l1.286-3.957z" />            </svg>          ))}          {fractionalPart > 0 && (            <svg              className="size-4 fill-current"              viewBox="0 0 20 20"            >              <defs>                <linearGradient id="half">                  <stop                    offset={`${fractionalPart * 100}%`}                    stopColor="currentColor"                  />                  <stop                    offset={`${fractionalPart * 100}%`}                    stopColor="#D1D5DB"                  />                </linearGradient>              </defs>              <path                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.957a1 1 0 00.95.69h4.162c.969 0 1.371 1.24.588 1.81l-3.37 2.448a1 1 0 00-.364 1.118l1.287 3.957c.3.921-.755 1.688-1.54 1.118l-3.37-2.448a1 1 0 00-1.175 0l-3.37 2.448c-.784.57-1.838-.197-1.54-1.118l1.287-3.957a1 1 0 00-.364-1.118L2.05 9.384c-.783-.57-.38-1.81.588-1.81h4.162a1 1 0 00.95-.69l1.286-3.957z"                fill="url(#half)"              />            </svg>          )}          {[...Array(emptyStars)].map((_, index) => (            <svg              key={`empty-${index}`}              className="size-4 text-gray-300 fill-current"              viewBox="0 0 20 20"            >              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.957a1 1 0 00.95.69h4.162c.969 0 1.371 1.24.588 1.81l-3.37 2.448a1 1 0 00-.364 1.118l1.287 3.957c.3.921-.755 1.688-1.54 1.118l-3.37-2.448a1 1 0 00-1.175 0l-3.37 2.448c-.784.57-1.838-.197-1.54-1.118l1.287-3.957a1 1 0 00-.364-1.118L2.05 9.384c-.783-.57-.38-1.81.588-1.81h4.162a1 1 0 00.95-.69l1.286-3.957z" />            </svg>          ))}        </div>        <p className="sr-only">{rating} out of {maxRating} stars</p>      </div>    )  })ReviewStars.displayName = "ReviewStars"