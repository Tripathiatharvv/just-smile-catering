"use client";import { motion, useInView } from "framer-motion";import { useRef, useState } from "react";import { Send, Phone, Mail, MapPin, Clock } from "lucide-react";import { Map } from "./Map";import { supabase } from "@/lib/supabase";import { toast } from "sonner";interface ContactProps {  showMap?: boolean;  showForm?: boolean;}const RATE_LIMIT_HOURS = 10;const MAX_SUBMISSIONS = 2;const MAX_CHAR_LIMIT = 500;export function Contact({ showMap = true, showForm = true }: ContactProps) {  const ref = useRef<HTMLDivElement>(null);  const isInView = useInView(ref, { once: true, margin: "-100px" });  const [loading, setLoading] = useState(false);  const [formState, setFormState] = useState({    name: "",    email: "",    phone: "",    eventType: "",    guests: "",    date: "",    message: "",  });  const checkRateLimit = () => {    const submissions = JSON.parse(localStorage.getItem("form_submissions") || "[]");    const now = Date.now();    const tenHoursAgo = now - RATE_LIMIT_HOURS * 60 * 60 * 1000;    const recentSubmissions = submissions.filter((time: number) => time > tenHoursAgo);    if (recentSubmissions.length >= MAX_SUBMISSIONS) {      return false;    }    return true;  };  const recordSubmission = () => {    const submissions = JSON.parse(localStorage.getItem("form_submissions") || "[]");    submissions.push(Date.now());    localStorage.setItem("form_submissions", JSON.stringify(submissions));  };  const handleSubmit = async (e: React.FormEvent) => {    e.preventDefault();    if (!checkRateLimit()) {      toast.error(`You have reached the submission limit. Please try again in ${RATE_LIMIT_HOURS} hours.`);      return;    }    if (formState.message.length > MAX_CHAR_LIMIT) {      toast.error(`Message is too long. Limit is ${MAX_CHAR_LIMIT} characters.`);      return;    }    setLoading(true);    try {      const { error } = await supabase.from("leads").insert([        {          name: formState.name,          email: formState.email,          phone: formState.phone,          service_type: formState.eventType,          message: `Guests: ${formState.guests}\nDate: ${formState.date}\nMessage: ${formState.message}`,        },      ]);      if (error) throw error;      recordSubmission();      toast.success("Thank you for your inquiry! We will get back to you shortly.");      setFormState({        name: "",        email: "",        phone: "",        eventType: "",        guests: "",        date: "",        message: "",      });    } catch (error) {      console.error("Error submitting form:", error);      toast.error("Failed to submit form. Please try again.");    } finally {      setLoading(false);    }  };  const contactInfo = [    {      icon: Phone,      label: "Phone",      value: "+91-9828038555",      href: "tel:+919828038555",    },    {      icon: Mail,      label: "Email",      value: "Justsmilemanagement@gmail.com",      href: "mailto:Justsmilemanagement@gmail.com",    },    {      icon: MapPin,      label: "Address",      value: "Plot No. SK-204, Sector-112, Gautam Budh Nagar Greater Noida",      href: "https://maps.google.com/?q=Plot+No.+SK-204,+Sector-112,+Gautam+Budh+Nagar+Greater+Noida",    },    {      icon: Clock,      label: "Hours",      value: "Mon-Sat: 9AM - 8PM",      href: "#",    },  ];  return (    <section id="contact" className="py-24 bg-white">      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">        <motion.div          ref={ref}          initial={{ opacity: 0, y: 40 }}          animate={isInView ? { opacity: 1, y: 0 } : {}}          transition={{ duration: 0.8 }}          className="text-center mb-16"        >          <div className="flex items-center justify-center gap-3 mb-4">            <div className="w-12 h-[2px] bg-[#FFD447]" />            <span className="font-sans text-sm font-semibold tracking-widest text-[#666666] uppercase">              Get in Touch            </span>            <div className="w-12 h-[2px] bg-[#FFD447]" />          </div>          <h2 className="font-serif text-4xl sm:text-5xl text-[#1a1a1a] mb-4">            Let&apos;s Plan Your <span className="text-[#FFD447] italic">Event</span>          </h2>          <p className="font-sans text-lg text-[#666666] max-w-2xl mx-auto">            Ready to create an unforgettable culinary experience? Reach out to us            and let&apos;s discuss your requirements.          </p>        </motion.div>        <div className={`grid ${showForm ? 'lg:grid-cols-5' : 'max-w-3xl mx-auto'} gap-12 items-start`}>          <motion.div            initial={{ opacity: 0, x: -50 }}            animate={isInView ? { opacity: 1, x: 0 } : {}}            transition={{ duration: 0.8, delay: 0.2 }}            className={`${showForm ? 'lg:col-span-2' : 'w-full'} space-y-8`}          >            <div className={`grid ${!showForm ? 'sm:grid-cols-2' : ''} gap-6`}>              {contactInfo.map((info, index) => {                const colors = ["#4A2C2A", "#2D5A27", "#FFD447", "#2D5A27"];                const currentColor = colors[index % colors.length];                return (                  <motion.a                    key={info.label}                    href={info.href}                    initial={{ opacity: 0, y: 20 }}                    animate={isInView ? { opacity: 1, y: 0 } : {}}                    transition={{ delay: 0.3 + index * 0.1 }}                    className="flex items-start gap-4 group"                  >                    <div                      className="w-14 h-14 rounded-2xl flex items-center justify-center flex-shrink-0 bg-gradient-to-br from-[#CAA845] to-[#E6B65C] shadow-lg shadow-[#CAA845]/20 group-hover:shadow-xl group-hover:shadow-[#CAA845]/30 transition-all duration-300 border border-white/20"                    >                      <info.icon                        className="w-6 h-6 text-[#561C24] group-hover:scale-110 transition-transform"                      />                    </div>                    <div>                      <p className="font-sans text-sm text-[#666666]">{info.label}</p>                      <p className="font-sans font-medium text-[#1a1a1a]">                        {info.value}                      </p>                    </div>                  </motion.a>                );              })}            </div>            <div className="bg-gradient-to-br from-[#4A2C2A]/10 via-[#2D5A27]/10 to-[#FFD447]/10 rounded-2xl p-6 border border-white/50 shadow-sm">              <h3 className="font-serif text-xl text-[#1a1a1a] mb-3">                Quick Quote via WhatsApp              </h3>              <p className="font-sans text-sm text-[#666666] mb-4">                Get instant responses on WhatsApp for faster communication.              </p>              <a                href="https://wa.me/919828038555"                target="_blank"                rel="noopener noreferrer"                className="inline-flex items-center gap-2 bg-[#25D366] text-white px-6 py-3 rounded-full font-sans font-semibold hover:bg-[#25D366]/90 transition-all shadow-md"              >                <svg                  viewBox="0 0 24 24"                  width={18}                  height={18}                  fill="currentColor"                >                  <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z" />                </svg>                Chat on WhatsApp              </a>            </div>            {showMap && (              <motion.div                initial={{ opacity: 0, scale: 0.95 }}                animate={isInView ? { opacity: 1, scale: 1 } : {}}                transition={{ duration: 0.8, delay: 0.5 }}                className="pt-4"              >                <Map />              </motion.div>            )}          </motion.div>          {showForm && (            <motion.div              initial={{ opacity: 0, x: 50 }}              animate={isInView ? { opacity: 1, x: 0 } : {}}              transition={{ duration: 0.8, delay: 0.4 }}              className="lg:col-span-3"            >              <form                onSubmit={handleSubmit}                className="bg-[#f9f9f9] rounded-2xl p-8"              >                <div className="grid sm:grid-cols-2 gap-6">                  <div>                    <label className="block font-sans text-sm text-[#666666] mb-2">                      Your Name *                    </label>                    <input                      type="text"                      required                      value={formState.name}                      onChange={(e) =>                        setFormState({ ...formState, name: e.target.value })                      }                      className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans"                      placeholder="John Doe"                      disabled={loading}                    />                  </div>                  <div>                    <label className="block font-sans text-sm text-[#666666] mb-2">                      Email Address *                    </label>                    <input                      type="email"                      required                      value={formState.email}                      onChange={(e) =>                        setFormState({ ...formState, email: e.target.value })                      }                      className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans"                      placeholder="john@example.com"                      disabled={loading}                    />                  </div>                  <div>                    <label className="block font-sans text-sm text-[#666666] mb-2">                      Phone Number *                    </label>                    <input                      type="tel"                      required                      value={formState.phone}                      onChange={(e) =>                        setFormState({ ...formState, phone: e.target.value })                      }                      className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans"                      placeholder="+91-9828038555"                      disabled={loading}                    />                  </div>                  <div>                    <label className="block font-sans text-sm text-[#666666] mb-2">                      Event Type *                    </label>                    <select                      required                      value={formState.eventType}                      onChange={(e) =>                        setFormState({ ...formState, eventType: e.target.value })                      }                      className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans bg-white"                      disabled={loading}                    >                      <option value="">Select event type</option>                      <option value="wedding">Wedding</option>                      <option value="corporate">Corporate Event</option>                      <option value="private">Private Dining</option>                      <option value="festival">Festival Catering</option>                      <option value="other">Other</option>                    </select>                  </div>                  <div>                    <label className="block font-sans text-sm text-[#666666] mb-2">                      Number of Guests                    </label>                    <input                      type="text"                      value={formState.guests}                      onChange={(e) =>                        setFormState({ ...formState, guests: e.target.value })                      }                      className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans"                      placeholder="e.g., 100-150"                      disabled={loading}                    />                  </div>                  <div>                    <label className="block font-sans text-sm text-[#666666] mb-2">                      Event Date                    </label>                    <input                      type="date"                      value={formState.date}                      onChange={(e) =>                        setFormState({ ...formState, date: e.target.value })                      }                      className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans"                      disabled={loading}                    />                  </div>                </div>                <div className="mt-6">                  <label className="block font-sans text-sm text-[#666666] mb-2">                    Tell us about your event                    <span className="float-right text-xs">                      {formState.message.length}/{MAX_CHAR_LIMIT}                    </span>                  </label>                  <textarea                    rows={4}                    value={formState.message}                    onChange={(e) =>                      setFormState({ ...formState, message: e.target.value })                    }                    maxLength={MAX_CHAR_LIMIT}                    className="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-[#2D5A27] focus:ring-2 focus:ring-[#2D5A27]/20 transition-all outline-none font-sans resize-none"                    placeholder="Any specific requirements, dietary restrictions, or preferences..."                    disabled={loading}                  />                </div>                <button                  type="submit"                  disabled={loading}                  className="mt-6 w-full flex items-center justify-center gap-2 bg-[#4A2C2A] text-white px-8 py-4 rounded-full font-sans font-semibold hover:bg-[#4A2C2A]/90 transition-all hover:scale-[1.02] shadow-lg shadow-[#4A2C2A]/30 disabled:opacity-70 disabled:cursor-not-allowed"                >                  {loading ? (                    <div className="animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"></div>                  ) : (                    <>                      <Send size={18} />                      Send Inquiry                    </>                  )}                </button>              </form>            </motion.div>          )}        </div>      </div>    </section>  );}